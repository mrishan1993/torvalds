# Kukai-Embed

Kukai-Embed embeds a Kukai component instance into a page via an iFrame and exposes an API to the consuming application to interact with the Kukai instance. This allows applications to leverage the Tezos ecosystem in an convenient and user-friendly way without being concerned about wallets or key management.

## Usage

Kukai-Embed is designed to provide a convenient interface for applications to interact with the Tezos blockchain ecosystem while also keeping users in control. The API provides an asynchronous wrapper for communication with a Kukai instance which manages the user's keys and accounts which applications can `await` while the user interacts with the Kukai UI.

### Initialization

Kukai-Embed needs only to be constructed and initialized:
``` typescript
import { KukaiEmbed, Networks } from 'kukai-embed';

// construct the embed instance using mainnet (also the default value)
const embed = new KukaiEmbed({
    net: Networks.mainnet,
    icon: true
});

// wait for the embedded Kukai instance to be initialized
await embed.init();
```

### Login

Login presents a DirectAuth UI to the user and a promise to the application, which resolves with user account into when DirectAuth completes or rejects if the DirectAuth prompt is closed:
``` typescript
const userInfo = await embed.login();
```

### User Status

The embed persists the user's information on login and clears it on logout. It can be accessed from the `.user` field and will be `null` if a user is not logged in:

``` typescript
const userInfo = embed.user
```

### Send Tezos Operations

Send allows an application to pass a Tezos Operation to the user for approval using the Kukai UI. The application can await the returned promise to recieve the Operation Hash of the Operation when the user approves, or the rejection should they disapprove. This function returns when the Operation has been submitted, but does not track it to confirmation:
``` typescript
const operationInfo = await embed.send([{
    kind: 'transaction',
    destination: 'tz1NBvY7qUedReRcYx8gqV34c8fUuks8o8Nr',
    amount: '10000'
}]);
```

### Track Tezos Operations

Kukai-Embed can also provide tracking of Tezos Operations if desired by the application, which resolves when the Operation is fully confirmed and committed to the Tezos Blockchain:
``` typescript
const operationResult = await embed.trackOperation(operationInfo.opHash);
```

### Authentication

Kukai-Embed can provide user authentication for applications based on their Tezos private key. `authenticate` takes an identifier for the authentication request and a challenge nonce to be signed. It returns a message which is created from the request and nonce, as well as a signature which is made using the returned message and the private key of the logged-in user. This signature can be verified using the message and the user's public key in order to prove authentication of the user.
``` typescript
const { message, signature } = await embed.authenticate('example request ID', 'example nonce')
```

### Logout

Logout clears the Kukai instance of key information and returns it to a logged-out (but still initialized) state:
``` typescript
await embed.logout();
```

## Examples

See the `examples` directory for simple examples of Kukai-Embed appearing in consuming applications.

## Building

To build Kukai-Embed, use `yarn build` or `npm run build`.

## Running unit tests

To run the unit tests, use `yarn test` or `npm run test`. Unit tests make use of Jest and JS-DOM.
